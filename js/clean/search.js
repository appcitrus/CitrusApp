function InitSearch(){	$('#search_autocomplete,#search-page .ui-input-clear').hide();	 LoadSearchResults(0);	 var LS = LazyListViewComponent("search-listview","search-page",LoadSearchResults);	}function LoadSearchResults(position_to_get){		var request = "&q="+encodeURIComponent($(".ui-input-search input").val());	ShowLoading();	$.ajax({ 	  url: "http://m.citrus.ua/ajax/search.php?position="+position_to_get+"&count=40"+request,	  dataType: 'json', 	  success: function( json ) {			 var output = "";			 var count = 0;		 if(json.items !== undefined ){			 $.each( json.items, function( key, value ) {				count = count +1;	 				var url ;							url = "category-items=" +  value.link;					var lazy = "";				if(key ==json.items.length-1){					if(json.parameters && json.parameters.lazy && json.parameters.lazy == 1){						lazy = "lazy_load_more";					}				}								var dop_class="";				if(value.price){					dop_class=dop_class+" product";					url = "#product-card?product-id=" + value.id;										var row2 = '';					if(parseInt(value.price) > 1 && value.can_buy =="Y"){						row2 = '<div class="price">'+value.price+' грн</div>';						}else{						row2 = '<div class="status">'+value.can_buy_status+'</div>';;					}					output += generateSearchItem(value,lazy);				}			});				 }else{					output = '<h2 class="bad_search_result">к сожалению ничего не найдено...</h2>';			 }			 if( position_to_get > 0){				  $('#search-listview').html($('#search-listview').html()+output).listview("refresh");			 }else{				  $('#search-listview').html(output).listview("refresh");			 }				 $.mobile.loading( "hide" );			 ProssedTapEvents();			 		 }, 	  timeout: 25000 ,	  error: function(jqXHR, status, errorThrown){   //the status returned will be "timeout" 		 $.mobile.loading( "hide" );			ShowMessage(1);	  } 	});}function generateSearchItem(value,lazy){	var dop_class="";	if(value.price){		dop_class=dop_class+" product";		url = "#product-card?product-id=" + value.id;		row2 = '';		if(value.can_buy_status !== undefined ){			row2 = '<div class="status">'+value.can_buy_status+'</div>';		}		if(parseInt(value.price) > 1 && value.can_buy =="Y"){			row2 = '<div class="price">'+value.price+' грн</div>';			}		return '<li class="'+lazy+'"><a data-transition="slide" data-ajax=false  class="vclick_d_link"  link="'+url+'"><table style="width:100%"><tr><td style="vertical-align: middle;text-align:center;width:64px" class="first"><img src="' + value.image + '" ></td><td style="vertical-align:middle;text-align:left;padding-left:1.1rem;"><h2 class="item_name_only '+dop_class+'">' + value.name + '</h2>'+row2+'</td><td style="width:25px"></td></tr></table></a></li>';	}	}function InitSearchAutocomplete(){	$("#search_autocomplete").on( "listviewbeforefilter", function ( e, data ) {        var $ul = $( this ),            $input = $( data.input ),            value = $input.val(),            html = "";        $ul.html( "" );        if ( value && value.length > 2 ) {            $ul.html( "<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>" );            $ul.listview( "refresh" );            $.ajax({                url: "http://m.citrus.ua/ajax/search-autocomplete.php",                dataType: "json",                crossDomain: true,                data: {                    q: $input.val()                }            })            .then( function ( json ) {            	if(json !== undefined ){            		$('#search_autocomplete,#search-page .ui-input-clear').show();	                $.each( json, function ( i, value ) {						value.id = value.ID;						value.name = value.value;						value.price = value.mprice;	                    html += generateSearchItem(value,false);	                });	                $ul.html(html).listview("refresh").trigger("updatelayout");	                ProssedTapEvents();        		}            });        }    });}function InitCityAutocomplete(){	$("#preorder_city_autocomplete").on( "listviewbeforefilter", function ( e, data ) {        var $ul = $(this),            $input = $( data.input ),            value = $input.val(),            html = "";        $ul.html( "" );        if ( value && value.length > 2 ) {            $ul.html( "<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>" );            $ul.listview( "refresh" );            $.ajax({                url: "http://m.citrus.ua/api/delivery-autocomplete.php",                dataType: "json",                crossDomain: true,                data: {                    term: $input.val()                }            })            .then( function ( json ) {            	console.log(json);            	if(json !== undefined ){            		//$('#preorder_city_autocomplete').show();	                $.each( json, function ( i, value ) {						html += '<li class=""><a data-ajax=false onclick="selectCity(\''+item.id+'\',\''+item.city_name+'\')"><table style="width:100%"><tr><td class="suggeintem"><h2 class="item_name_only ">' + item.value + '</h2></td><td style="width:25px"></td></tr></table></a></li>';	                });	                console.log(html);	                $ul.html(html).listview("refresh").trigger("updatelayout");        		}            });        }    });}